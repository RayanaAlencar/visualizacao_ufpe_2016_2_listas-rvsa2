<!DOCTYPE html>
<!-- saved from url=(0083)http://www.cin.ufpe.br/~nivan/teaching/data_vis/fall_2016/material/lecture10_1.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		
		<title>Mapa Recife</title>
		<script type="text/javascript" src="./D3_ Scaling the AlbersUSA projection_files/d3.v4.min.js.download"></script>
		<style type="text/css">		
		</style>
	</head>
	<body>
		<script type="text/javascript">
			var xOffset = 0;
			var yOffset = 0;
			var initialMousePosition  = [0,0] 
			var state = "idle";
			
			//var color = d3.Linearscale().range(["rgb(237,248,233)", "rgb(186,228,179)", "rgb(116,196,118)", "rgb(49,163,84)","rgb(0,109,44)"]);					
			
			//Width and height
			var w = 900;
			var h = 900;
			var projecao = 100000;
			
			//Define path generator
			var projection = d3.geoMercator()
			.translate([w/2, h/2])
			.center([-34.87986,-8.05596])
			.scale(projecao);

			var path = d3.geoPath()
				.projection(projection);

			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			var arrayJson = []	;		
			//Load in GeoJSON data
			d3.json("bairros.json", function(json) {
					for(var i =0;i<json.features.length;i++){
						var obj = json.features[i];
						console.log(typeof(obj)," " , obj);
						arrayJson.push(obj);
						//console.log("Tamanho de arrayJson eh ",arrayJson.length);
					}
				//Bind data and create one path per GeoJSON feature
				svg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .attr("fill","#00CED1");
		
			});
			
			
			d3.json("acidentes-2014-11-novembro.json",function(data){
			    //color.domain([ d3.min(data, function(d) { return d.value; }), d3.max(data, function(d) { return d.value; })]);
				//console.log("AQUIIIIIIIIIIIIIII",data.features.length);
				d3.json("bairros.json", function(json) {
				var aux = data.features;
				for (var i = 0; i < aux.length; i++) {
				var cood = aux[i];
				var j = json[i];
					console.log("cood " ,cood," json ",j);
					break;
				/* var dataValue = parseFloat(data[i].value);
				
				for (var j = 0; j < json.features.length; j++) {
				var jsonState = json.features[j].properties.name;
				if (dataState == jsonState) {
					
					json.features[j].properties.value = dataValue;
				
					break;
					*/
					}
				});
			});

				  		
		
			d3.select("svg")
			.on("mousedown",function(d){
				var p = d3.mouse( this);
				initialMousePosition = p;
				state = "pan";
				d3.event.stopPropagation();
				d3.event.preventDefault();
			})
			.on("mousemove",function(d){
				if(state === "pan"){
				var p = d3.mouse( this),
					move = {
						x : p[0] - initialMousePosition[0],
						y : p[1] - initialMousePosition[1]
					};
				xOffset -= (move.x);
				yOffset += (move.y);
				initialMousePosition = p;    
					renderDataset();
				}
				d3.event.stopPropagation();
				d3.event.preventDefault();
			})
			.on("mouseup",function(d){	
				state = "idle";
				renderDataset();
				d3.event.stopPropagation();
				d3.event.preventDefault();
			})
			.on("wheel.zoom",function(d){
				d3.event.stopPropagation();
				d3.event.preventDefault();
				if(d3.event.wheelDeltaY > 0)
				projecao = projecao+(100000/2);
				else
				projecao = projecao-(100000/2);
				renderDataset();  
			});
			
			
			
		function renderDataset(){
	
			//Define path generator
			var projection = d3.geoMercator()
			.translate([w/2+xOffset, h/2+ yOffset])
			.center([-34.87986,-8.05596])
			.scale(projecao);
			
			var svg = d3.select("body")
						.select("svg");

						
			var path = d3.geoPath().projection(projection);
			
			
				var paths = svg.selectAll("path").data(arrayJson);	   
				paths.exit().remove();
			
		

			//Load in GeoJSON data
					 
				   svg.selectAll("path").data(arrayJson)
				   .attr("d", path);
		
			
					
}
			
		</script>
	

</body>
</html>